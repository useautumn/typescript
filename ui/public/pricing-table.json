{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "pricing-table",
  "type": "registry:component",
  "dependencies": [
    "autumn-js"
  ],
  "registryDependencies": [
    "switch",
    "button",
    "dialog",
    "popover",
    "input",
    "accordion"
  ],
  "files": [
    {
      "path": "registry/checkout-dialog/checkout-dialog.tsx",
      "content": "\"use client\";\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\";\nimport type { CheckoutParams, CheckoutResult, ProductItem } from \"autumn-js\";\nimport { ArrowRight, ChevronDown, Loader2 } from \"lucide-react\";\nimport type React from \"react\";\nimport { useEffect, useState } from \"react\";\nimport {\n\tAccordion,\n\tAccordionContent,\n\tAccordionItem,\n} from \"@/components/ui/accordion\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n\tDialog,\n\tDialogContent,\n\tDialogFooter,\n\tDialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Input } from \"@/components/ui/input\";\nimport {\n\tPopover,\n\tPopoverContent,\n\tPopoverTrigger,\n} from \"@/components/ui/popover\";\nimport { useCustomer } from \"autumn-js/react\";\nimport { cn } from \"@/lib/utils\";\nimport { getCheckoutContent } from \"@/registry/checkout-dialog/lib/checkout-content\";\n\nexport interface CheckoutDialogProps {\n\topen: boolean;\n\tsetOpen: (open: boolean) => void;\n\tcheckoutResult: CheckoutResult;\n\tcheckoutParams?: CheckoutParams;\n}\n\nconst formatCurrency = ({\n\tamount,\n\tcurrency,\n}: {\n\tamount: number;\n\tcurrency: string;\n}) => {\n\treturn new Intl.NumberFormat(\"en-US\", {\n\t\tstyle: \"currency\",\n\t\tcurrency: currency,\n\t}).format(amount);\n};\n\nexport default function CheckoutDialog(params: CheckoutDialogProps) {\n\tconst { attach } = useCustomer();\n\tconst [checkoutResult, setCheckoutResult] = useState<\n\t\tCheckoutResult | undefined\n\t>(params?.checkoutResult);\n\n\tuseEffect(() => {\n\t\tif (params.checkoutResult) {\n\t\t\tsetCheckoutResult(params.checkoutResult);\n\t\t}\n\t}, [params.checkoutResult]);\n\n\tconst [loading, setLoading] = useState(false);\n\n\tif (!checkoutResult) {\n\t\treturn <></>;\n\t}\n\n\tconst { open, setOpen } = params;\n\tconst { title, message } = getCheckoutContent(checkoutResult);\n\n\tconst isFree = checkoutResult?.product.properties?.is_free;\n\tconst isPaid = isFree === false;\n\n\treturn (\n\t\t<Dialog open={open} onOpenChange={setOpen}>\n\t\t\t<DialogContent className=\"p-0 pt-4 gap-0 text-foreground text-sm\">\n\t\t\t\t<DialogTitle className=\"px-6 mb-1\">{title}</DialogTitle>\n\t\t\t\t<div className=\"px-6 mt-1 mb-4 text-muted-foreground\">\n\t\t\t\t\t{message}\n\t\t\t\t</div>\n\n\t\t\t\t{isPaid && checkoutResult && (\n\t\t\t\t\t<PriceInformation\n\t\t\t\t\t\tcheckoutResult={checkoutResult}\n\t\t\t\t\t\tsetCheckoutResult={setCheckoutResult}\n\t\t\t\t\t/>\n\t\t\t\t)}\n\n\t\t\t\t<DialogFooter className=\"flex flex-col sm:flex-row justify-between gap-x-4 py-2 pl-6 pr-3 bg-secondary border-t shadow-inner\">\n\t\t\t\t\t<Button\n\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\tonClick={async () => {\n\t\t\t\t\t\t\tsetLoading(true);\n\n\t\t\t\t\t\t\tconst options = checkoutResult.options.map((option) => {\n\t\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\t\tfeatureId: option.feature_id,\n\t\t\t\t\t\t\t\t\tquantity: option.quantity,\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tawait attach({\n\t\t\t\t\t\t\t\tproductId: checkoutResult.product.id,\n\t\t\t\t\t\t\t\t...(params.checkoutParams || {}),\n\t\t\t\t\t\t\t\toptions,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tsetOpen(false);\n\t\t\t\t\t\t\tsetLoading(false);\n\t\t\t\t\t\t}}\n\t\t\t\t\t\tdisabled={loading}\n\t\t\t\t\t\tclassName=\"min-w-16 flex items-center gap-2\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{loading ? (\n\t\t\t\t\t\t\t<Loader2 className=\"w-4 h-4 animate-spin\" />\n\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t<span className=\"whitespace-nowrap flex gap-1\">\n\t\t\t\t\t\t\t\t\tConfirm\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</Button>\n\t\t\t\t</DialogFooter>\n\t\t\t</DialogContent>\n\t\t</Dialog>\n\t);\n}\n\nfunction PriceInformation({\n\tcheckoutResult,\n\tsetCheckoutResult,\n}: {\n\tcheckoutResult: CheckoutResult;\n\tsetCheckoutResult: (checkoutResult: CheckoutResult) => void;\n}) {\n\treturn (\n\t\t<div className=\"px-6 mb-4 flex flex-col gap-4\">\n\t\t\t<ProductItems\n\t\t\t\tcheckoutResult={checkoutResult}\n\t\t\t\tsetCheckoutResult={setCheckoutResult}\n\t\t\t/>\n\n\t\t\t<div className=\"flex flex-col gap-2\">\n\t\t\t\t{checkoutResult?.has_prorations && checkoutResult.lines.length > 0 && (\n\t\t\t\t\t<CheckoutLines checkoutResult={checkoutResult} />\n\t\t\t\t)}\n\t\t\t\t<DueAmounts checkoutResult={checkoutResult} />\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n\nfunction DueAmounts({ checkoutResult }: { checkoutResult: CheckoutResult }) {\n\tconst { next_cycle, product } = checkoutResult;\n\tconst nextCycleAtStr = next_cycle\n\t\t? new Date(next_cycle.starts_at).toLocaleDateString()\n\t\t: undefined;\n\n\tconst hasUsagePrice = product.items.some(\n\t\t(item) => item.usage_model === \"pay_per_use\",\n\t);\n\n\tconst showNextCycle = next_cycle && next_cycle.total !== checkoutResult.total;\n\n\treturn (\n\t\t<div className=\"flex flex-col gap-1\">\n\t\t\t<div className=\"flex justify-between\">\n\t\t\t\t<div>\n\t\t\t\t\t<p className=\"font-medium text-md\">Total due today</p>\n\t\t\t\t</div>\n\n\t\t\t\t<p className=\"font-medium text-md\">\n\t\t\t\t\t{formatCurrency({\n\t\t\t\t\t\tamount: checkoutResult?.total,\n\t\t\t\t\t\tcurrency: checkoutResult?.currency,\n\t\t\t\t\t})}\n\t\t\t\t</p>\n\t\t\t</div>\n\t\t\t{showNextCycle && (\n\t\t\t\t<div className=\"flex justify-between text-muted-foreground\">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<p className=\"text-md\">Due next cycle ({nextCycleAtStr})</p>\n\t\t\t\t\t</div>\n\t\t\t\t\t<p className=\"text-md\">\n\t\t\t\t\t\t{formatCurrency({\n\t\t\t\t\t\t\tamount: next_cycle.total,\n\t\t\t\t\t\t\tcurrency: checkoutResult?.currency,\n\t\t\t\t\t\t})}\n\t\t\t\t\t\t{hasUsagePrice && <span> + usage prices</span>}\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\t\t\t)}\n\t\t</div>\n\t);\n}\n\nfunction ProductItems({\n\tcheckoutResult,\n\tsetCheckoutResult,\n}: {\n\tcheckoutResult: CheckoutResult;\n\tsetCheckoutResult: (checkoutResult: CheckoutResult) => void;\n}) {\n\tconst isUpdateQuantity =\n\t\tcheckoutResult?.product.scenario === \"active\" &&\n\t\tcheckoutResult.product.properties.updateable;\n\n\tconst isOneOff = checkoutResult?.product.properties.is_one_off;\n\n\treturn (\n\t\t<div className=\"flex flex-col gap-2\">\n\t\t\t<p className=\"text-sm font-medium\">Price</p>\n\t\t\t{checkoutResult?.product.items\n\t\t\t\t.filter((item) => item.type !== \"feature\")\n\t\t\t\t.map((item, index) => {\n\t\t\t\t\tif (item.usage_model == \"prepaid\") {\n\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t<PrepaidItem\n\t\t\t\t\t\t\t\tkey={index}\n\t\t\t\t\t\t\t\titem={item}\n\t\t\t\t\t\t\t\tcheckoutResult={checkoutResult!}\n\t\t\t\t\t\t\t\tsetCheckoutResult={setCheckoutResult}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (isUpdateQuantity) {\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn (\n\t\t\t\t\t\t<div key={index} className=\"flex justify-between\">\n\t\t\t\t\t\t\t<p className=\"text-muted-foreground\">\n\t\t\t\t\t\t\t\t{item.feature\n\t\t\t\t\t\t\t\t\t? item.feature.name\n\t\t\t\t\t\t\t\t\t: isOneOff\n\t\t\t\t\t\t\t\t\t\t? \"Price\"\n\t\t\t\t\t\t\t\t\t\t: \"Subscription\"}\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t{item.display?.primary_text} {item.display?.secondary_text}\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t);\n\t\t\t\t})}\n\t\t</div>\n\t);\n}\n\nfunction CheckoutLines({ checkoutResult }: { checkoutResult: CheckoutResult }) {\n\treturn (\n\t\t<Accordion type=\"single\" collapsible>\n\t\t\t<AccordionItem value=\"total\" className=\"border-b-0\">\n\t\t\t\t<CustomAccordionTrigger className=\"justify-between w-full my-0 py-0 border-none\">\n\t\t\t\t\t<div className=\"cursor-pointer flex items-center gap-1 w-full justify-end\">\n\t\t\t\t\t\t<p className=\"font-light text-muted-foreground\">\n\t\t\t\t\t\t\tView details\n\t\t\t\t\t\t</p>\n\t\t\t\t\t\t<ChevronDown\n\t\t\t\t\t\t\tclassName=\"text-muted-foreground mt-0.5 rotate-90 transition-transform duration-200 ease-in-out\"\n\t\t\t\t\t\t\tsize={14}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</CustomAccordionTrigger>\n\t\t\t\t<AccordionContent className=\"mt-2 mb-0 pb-2 flex flex-col gap-2\">\n\t\t\t\t\t{checkoutResult?.lines\n\t\t\t\t\t\t.filter((line) => line.amount !== 0)\n\t\t\t\t\t\t.map((line, index) => {\n\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t<div key={index} className=\"flex justify-between\">\n\t\t\t\t\t\t\t\t\t<p className=\"text-muted-foreground\">{line.description}</p>\n\t\t\t\t\t\t\t\t\t<p className=\"text-muted-foreground\">\n\t\t\t\t\t\t\t\t\t\t{new Intl.NumberFormat(\"en-US\", {\n\t\t\t\t\t\t\t\t\t\t\tstyle: \"currency\",\n\t\t\t\t\t\t\t\t\t\t\tcurrency: checkoutResult?.currency,\n\t\t\t\t\t\t\t\t\t\t}).format(line.amount)}\n\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t})}\n\t\t\t\t</AccordionContent>\n\t\t\t</AccordionItem>\n\t\t</Accordion>\n\t);\n}\n\nfunction CustomAccordionTrigger({\n\tclassName,\n\tchildren,\n\t...props\n}: React.ComponentProps<typeof AccordionPrimitive.Trigger>) {\n\treturn (\n\t\t<AccordionPrimitive.Header className=\"flex\">\n\t\t\t<AccordionPrimitive.Trigger\n\t\t\t\tdata-slot=\"accordion-trigger\"\n\t\t\t\tclassName={cn(\n\t\t\t\t\t\"focus-visible:border-ring focus-visible:ring-ring/50 flex flex-1 items-start justify-between gap-4 rounded-md py-4 text-left text-sm font-medium transition-all outline-none focus-visible:ring-[3px] disabled:pointer-events-none disabled:opacity-50 [&[data-state=open]_svg]:rotate-0\",\n\t\t\t\t\tclassName,\n\t\t\t\t)}\n\t\t\t\t{...props}\n\t\t\t>\n\t\t\t\t{children}\n\t\t\t</AccordionPrimitive.Trigger>\n\t\t</AccordionPrimitive.Header>\n\t);\n}\n\nconst PrepaidItem = ({\n\titem,\n\tcheckoutResult,\n\tsetCheckoutResult,\n}: {\n\titem: ProductItem;\n\tcheckoutResult: CheckoutResult;\n\tsetCheckoutResult: (checkoutResult: CheckoutResult) => void;\n}) => {\n\tconst { quantity = 0, billing_units: billingUnits = 1 } = item;\n\tconst [quantityInput, setQuantityInput] = useState<string>(\n\t\t(quantity / billingUnits).toString(),\n\t);\n\tconst { checkout } = useCustomer();\n\tconst [loading, setLoading] = useState(false);\n\tconst [open, setOpen] = useState(false);\n\tconst scenario = checkoutResult.product.scenario;\n\n\tconst handleSave = async () => {\n\t\tsetLoading(true);\n\t\ttry {\n\t\t\tconst newOptions = checkoutResult.options\n\t\t\t\t.filter((option) => option.feature_id !== item.feature_id)\n\t\t\t\t.map((option) => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tfeatureId: option.feature_id,\n\t\t\t\t\t\tquantity: option.quantity,\n\t\t\t\t\t};\n\t\t\t\t});\n\n\t\t\tnewOptions.push({\n\t\t\t\tfeatureId: item.feature_id!,\n\t\t\t\tquantity: Number(quantityInput) * billingUnits,\n\t\t\t});\n\n\t\t\tconst { data, error } = await checkout({\n\t\t\t\tproductId: checkoutResult.product.id,\n\t\t\t\toptions: newOptions,\n\t\t\t\tdialog: CheckoutDialog,\n\t\t\t});\n\n\t\t\tif (error) {\n\t\t\t\tconsole.error(error);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tsetCheckoutResult(data!);\n\t\t} catch (error) {\n\t\t\tconsole.error(error);\n\t\t} finally {\n\t\t\tsetLoading(false);\n\t\t\tsetOpen(false);\n\t\t}\n\t};\n\n\tconst disableSelection = scenario === \"renew\";\n\n\treturn (\n\t\t<div className=\"flex justify-between gap-2\">\n\t\t\t<div className=\"flex gap-2 items-start\">\n\t\t\t\t<p className=\"text-muted-foreground whitespace-nowrap\">\n\t\t\t\t\t{item.feature?.name}\n\t\t\t\t</p>\n\t\t\t\t<Popover open={open} onOpenChange={setOpen}>\n\t\t\t\t\t<PopoverTrigger\n\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\"text-muted-foreground text-xs px-1 py-0.5 rounded-md flex items-center gap-1 bg-accent/80 shrink-0\",\n\t\t\t\t\t\t\tdisableSelection !== true &&\n\t\t\t\t\t\t\t\t\"hover:bg-accent hover:text-foreground\",\n\t\t\t\t\t\t\tdisableSelection &&\n\t\t\t\t\t\t\t\t\"pointer-events-none opacity-80 cursor-not-allowed\",\n\t\t\t\t\t\t)}\n\t\t\t\t\t\tdisabled={disableSelection}\n\t\t\t\t\t>\n\t\t\t\t\t\tQty: {quantity}\n\t\t\t\t\t\t{!disableSelection && <ChevronDown size={12} />}\n\t\t\t\t\t</PopoverTrigger>\n\t\t\t\t\t<PopoverContent\n\t\t\t\t\t\talign=\"start\"\n\t\t\t\t\t\tclassName=\"w-80 text-sm p-4 pt-3 flex flex-col gap-4\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div className=\"flex flex-col gap-1\">\n\t\t\t\t\t\t\t<p className=\"text-sm font-medium\">{item.feature?.name}</p>\n\t\t\t\t\t\t\t<p className=\"text-muted-foreground\">\n\t\t\t\t\t\t\t\t{item.display?.primary_text} {item.display?.secondary_text}\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div className=\"flex justify-between items-end\">\n\t\t\t\t\t\t\t<div className=\"flex gap-2 items-center\">\n\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\tclassName=\"h-7 w-16 focus:!ring-2\"\n\t\t\t\t\t\t\t\t\tvalue={quantityInput}\n\t\t\t\t\t\t\t\t\tonChange={(e) => setQuantityInput(e.target.value)}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t<p className=\"text-muted-foreground\">\n\t\t\t\t\t\t\t\t\t{billingUnits > 1 && `x ${billingUnits} `}\n\t\t\t\t\t\t\t\t\t{item.feature?.name}\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\tonClick={handleSave}\n\t\t\t\t\t\t\t\tclassName=\"w-14 !h-7 text-sm items-center bg-white text-foreground shadow-sm border border-zinc-200 hover:bg-zinc-100\"\n\t\t\t\t\t\t\t\tdisabled={loading}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{loading ? (\n\t\t\t\t\t\t\t\t\t<Loader2 className=\"text-muted-foreground animate-spin !w-4 !h-4\" />\n\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\"Save\"\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</PopoverContent>\n\t\t\t\t</Popover>\n\t\t\t</div>\n\t\t\t<p className=\"text-end\">\n\t\t\t\t{item.display?.primary_text} {item.display?.secondary_text}\n\t\t\t</p>\n\t\t</div>\n\t);\n};\n\nexport const PriceItem = ({\n\tchildren,\n\tclassName,\n\t...props\n}: {\n\tchildren: React.ReactNode;\n\tclassName?: string;\n} & React.HTMLAttributes<HTMLDivElement>) => {\n\treturn (\n\t\t<div\n\t\t\tclassName={cn(\n\t\t\t\t\"flex flex-col pb-4 sm:pb-0 gap-1 sm:flex-row justify-between sm:h-7 sm:gap-2 sm:items-center\",\n\t\t\t\tclassName,\n\t\t\t)}\n\t\t\t{...props}\n\t\t>\n\t\t\t{children}\n\t\t</div>\n\t);\n};\n\nexport const PricingDialogButton = ({\n\tchildren,\n\tsize,\n\tonClick,\n\tdisabled,\n\tclassName,\n}: {\n\tchildren: React.ReactNode;\n\tsize?: \"sm\" | \"lg\" | \"default\" | \"icon\";\n\tonClick: () => void;\n\tdisabled?: boolean;\n\tclassName?: string;\n}) => {\n\treturn (\n\t\t<Button\n\t\t\tonClick={onClick}\n\t\t\tdisabled={disabled}\n\t\t\tsize={size}\n\t\t\tclassName={cn(className, \"shadow-sm shadow-stone-400\")}\n\t\t>\n\t\t\t{children}\n\t\t\t<ArrowRight className=\"!h-3\" />\n\t\t</Button>\n\t);\n};\n",
      "type": "registry:component",
      "target": "components/autumn/checkout-dialog.tsx"
    },
    {
      "path": "registry/checkout-dialog/lib/checkout-content.tsx",
      "content": "import { type CheckoutResult } from \"autumn-js\";\n\nexport const getCheckoutContent = (checkoutResult: CheckoutResult) => {\n  const { product, current_product, next_cycle } = checkoutResult;\n  const { is_one_off, is_free, has_trial, updateable } = product.properties;\n  const scenario = product.scenario;\n\n  const nextCycleAtStr = next_cycle\n    ? new Date(next_cycle.starts_at).toLocaleDateString()\n    : undefined;\n\n  const productName = product.name;\n\n  if (is_one_off) {\n    return {\n      title: <p>Purchase {productName}</p>,\n      message: (\n        <p>\n          By clicking confirm, you will purchase {productName} and your card\n          will be charged immediately.\n        </p>\n      ),\n    };\n  }\n\n  if (scenario == \"active\" && updateable) {\n    if (updateable) {\n      return {\n        title: <p>Update Plan</p>,\n        message: (\n          <p>\n            Update your prepaid quantity. You&apos;ll be charged or credited the\n            prorated difference based on your current billing cycle.\n          </p>\n        ),\n      };\n    }\n  }\n\n  if (has_trial) {\n    return {\n      title: <p>Start trial for {productName}</p>,\n      message: (\n        <p>\n          By clicking confirm, you will start a free trial of {productName}{\" \"}\n          which ends on {nextCycleAtStr}.\n        </p>\n      ),\n    };\n  }\n\n  switch (scenario) {\n    case \"scheduled\":\n      return {\n        title: <p>{productName} product already scheduled</p>,\n        message: (\n          <p>\n            You are currently on product {current_product.name} and are\n            scheduled to start {productName} on {nextCycleAtStr}.\n          </p>\n        ),\n      };\n\n    case \"active\":\n      return {\n        title: <p>Product already active</p>,\n        message: <p>You are already subscribed to this product.</p>,\n      };\n\n    case \"new\":\n      if (is_free) {\n        return {\n          title: <p>Enable {productName}</p>,\n          message: (\n            <p>\n              By clicking confirm, {productName} will be enabled immediately.\n            </p>\n          ),\n        };\n      }\n\n      return {\n        title: <p>Subscribe to {productName}</p>,\n        message: (\n          <p>\n            By clicking confirm, you will be subscribed to {productName} and\n            your card will be charged immediately.\n          </p>\n        ),\n      };\n    case \"renew\":\n      return {\n        title: <p>Renew</p>,\n        message: (\n          <p>\n            By clicking confirm, you will renew your subscription to{\" \"}\n            {productName}.\n          </p>\n        ),\n      };\n\n    case \"upgrade\":\n      return {\n        title: <p>Upgrade to {productName}</p>,\n        message: (\n          <p>\n            By clicking confirm, you will upgrade to {productName} and your\n            payment method will be charged immediately.\n          </p>\n        ),\n      };\n\n    case \"downgrade\":\n      return {\n        title: <p>Downgrade to {productName}</p>,\n        message: (\n          <p>\n            By clicking confirm, your current subscription to{\" \"}\n            {current_product.name} will be cancelled and a new subscription to{\" \"}\n            {productName} will begin on {nextCycleAtStr}.\n          </p>\n        ),\n      };\n\n    case \"cancel\":\n      return {\n        title: <p>Cancel</p>,\n        message: (\n          <p>\n            By clicking confirm, your subscription to {current_product.name}{\" \"}\n            will end on {nextCycleAtStr}.\n          </p>\n        ),\n      };\n\n    default:\n      return {\n        title: <p>Change Subscription</p>,\n        message: <p>You are about to change your subscription.</p>,\n      };\n  }\n};\n",
      "type": "registry:lib",
      "target": "lib/autumn/checkout-content.tsx"
    },
    {
      "path": "registry/pricing-table/pricing-table.tsx",
      "content": "import React from \"react\";\n\nimport { useCustomer, usePricingTable, ProductDetails } from \"autumn-js/react\";\nimport { createContext, useContext, useState } from \"react\";\nimport { cn } from \"@/lib/utils\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Button } from \"@/components/ui/button\";\nimport CheckoutDialog from \"@/registry/checkout-dialog/checkout-dialog\";\nimport { getPricingTableContent } from \"@/registry/pricing-table/lib/pricing-table-content\";\nimport type { Product, ProductItem } from \"autumn-js\";\nimport { Loader2 } from \"lucide-react\";\n\nexport default function PricingTable({\n  productDetails,\n}: {\n  productDetails?: ProductDetails[];\n}) {\n  const { customer, checkout } = useCustomer({ errorOnNotFound: false });\n\n  const [isAnnual, setIsAnnual] = useState(false);\n  const { products, isLoading, error } = usePricingTable({ productDetails });\n\n  if (isLoading) {\n    return (\n      <div className=\"w-full h-full flex justify-center items-center min-h-[300px]\">\n        <Loader2 className=\"w-6 h-6 text-zinc-400 animate-spin\" />\n      </div>\n    );\n  }\n\n  if (error) {\n    return <div> Something went wrong...</div>;\n  }\n\n  const intervals = Array.from(\n    new Set(\n      products?.map((p) => p.properties?.interval_group).filter((i) => !!i)\n    )\n  );\n\n  const multiInterval = intervals.length > 1;\n\n  const intervalFilter = (product: Product) => {\n    if (!product.properties?.interval_group) {\n      return true;\n    }\n\n    if (multiInterval) {\n      if (isAnnual) {\n        return product.properties?.interval_group === \"year\";\n      } else {\n        return product.properties?.interval_group === \"month\";\n      }\n    }\n\n    return true;\n  };\n\n  return (\n    <div className={cn(\"root\")}>\n      {products && (\n        <PricingTableContainer\n          products={products}\n          isAnnualToggle={isAnnual}\n          setIsAnnualToggle={setIsAnnual}\n          multiInterval={multiInterval}\n        >\n          {products.filter(intervalFilter).map((product, index) => (\n            <PricingCard\n              key={index}\n              productId={product.id}\n              buttonProps={{\n                disabled:\n                  (product.scenario === \"active\" &&\n                    !product.properties.updateable) ||\n                  product.scenario === \"scheduled\",\n\n                onClick: async () => {\n                  if (product.id && customer) {\n                    await checkout({\n                      productId: product.id,\n                      dialog: CheckoutDialog,\n                    });\n                  } else if (product.display?.button_url) {\n                    window.open(product.display?.button_url, \"_blank\");\n                  }\n                },\n              }}\n            />\n          ))}\n        </PricingTableContainer>\n      )}\n    </div>\n  );\n}\n\nconst PricingTableContext = createContext<{\n  isAnnualToggle: boolean;\n  setIsAnnualToggle: (isAnnual: boolean) => void;\n  products: Product[];\n  showFeatures: boolean;\n}>({\n  isAnnualToggle: false,\n  setIsAnnualToggle: () => {},\n  products: [],\n  showFeatures: true,\n});\n\nexport const usePricingTableContext = (componentName: string) => {\n  const context = useContext(PricingTableContext);\n\n  if (context === undefined) {\n    throw new Error(`${componentName} must be used within <PricingTable />`);\n  }\n\n  return context;\n};\n\nexport const PricingTableContainer = ({\n  children,\n  products,\n  showFeatures = true,\n  className,\n  isAnnualToggle,\n  setIsAnnualToggle,\n  multiInterval,\n}: {\n  children?: React.ReactNode;\n  products?: Product[];\n  showFeatures?: boolean;\n  className?: string;\n  isAnnualToggle: boolean;\n  setIsAnnualToggle: (isAnnual: boolean) => void;\n  multiInterval: boolean;\n}) => {\n  if (!products) {\n    throw new Error(\"products is required in <PricingTable />\");\n  }\n\n  if (products.length === 0) {\n    return <></>;\n  }\n\n  const hasRecommended = products?.some((p) => p.display?.recommend_text);\n  return (\n    <PricingTableContext.Provider\n      value={{ isAnnualToggle, setIsAnnualToggle, products, showFeatures }}\n    >\n      <div\n        className={cn(\n          \"flex items-center flex-col\",\n          hasRecommended && \"!py-10\"\n        )}\n      >\n        {multiInterval && (\n          <div\n            className={cn(\n              products.some((p) => p.display?.recommend_text) && \"mb-8\"\n            )}\n          >\n            <AnnualSwitch\n              isAnnualToggle={isAnnualToggle}\n              setIsAnnualToggle={setIsAnnualToggle}\n            />\n          </div>\n        )}\n        <div\n          className={cn(\n            \"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-[repeat(auto-fit,minmax(200px,1fr))] w-full gap-2\",\n            className\n          )}\n        >\n          {children}\n        </div>\n      </div>\n    </PricingTableContext.Provider>\n  );\n};\n\ninterface PricingCardProps {\n  productId: string;\n  showFeatures?: boolean;\n  className?: string;\n  onButtonClick?: (event: React.MouseEvent<HTMLButtonElement>) => void;\n  buttonProps?: React.ComponentProps<\"button\">;\n}\n\nexport const PricingCard = ({\n  productId,\n  className,\n  buttonProps,\n}: PricingCardProps) => {\n  const { products, showFeatures } = usePricingTableContext(\"PricingCard\");\n\n  const product = products.find((p) => p.id === productId);\n\n  if (!product) {\n    throw new Error(`Product with id ${productId} not found`);\n  }\n\n  const { name, display: productDisplay } = product;\n\n  const { buttonText } = getPricingTableContent(product);\n\n  const isRecommended = productDisplay?.recommend_text ? true : false;\n  const mainPriceDisplay = product.properties?.is_free\n    ? {\n        primary_text: \"Free\",\n      }\n    : product.items[0].display;\n\n  const featureItems = product.properties?.is_free\n    ? product.items\n    : product.items.slice(1);\n\n  return (\n    <div\n      className={cn(\n        \" w-full h-full py-6 text-foreground border rounded-lg shadow-sm max-w-xl\",\n        isRecommended &&\n          \"lg:-translate-y-6 lg:shadow-lg dark:shadow-zinc-800/80 lg:h-[calc(100%+48px)] bg-secondary/40\",\n        className\n      )}\n    >\n      {productDisplay?.recommend_text && (\n        <RecommendedBadge recommended={productDisplay?.recommend_text} />\n      )}\n      <div\n        className={cn(\n          \"flex flex-col h-full flex-grow\",\n          isRecommended && \"lg:translate-y-6\"\n        )}\n      >\n        <div className=\"h-full\">\n          <div className=\"flex flex-col\">\n            <div className=\"pb-4\">\n              <h2 className=\"text-2xl font-semibold px-6 truncate\">\n                {productDisplay?.name || name}\n              </h2>\n              {productDisplay?.description && (\n                <div className=\"text-sm text-muted-foreground px-6 h-8\">\n                  <p className=\"line-clamp-2\">\n                    {productDisplay?.description}\n                  </p>\n                </div>\n              )}\n            </div>\n            <div className=\"mb-2\">\n              <h3 className=\"font-semibold h-16 flex px-6 items-center border-y mb-4 bg-secondary/40\">\n                <div className=\"line-clamp-2\">\n                  {mainPriceDisplay?.primary_text}{\" \"}\n                  {mainPriceDisplay?.secondary_text && (\n                    <span className=\"font-normal text-muted-foreground mt-1\">\n                      {mainPriceDisplay?.secondary_text}\n                    </span>\n                  )}\n                </div>\n              </h3>\n            </div>\n          </div>\n          {showFeatures && featureItems.length > 0 && (\n            <div className=\"flex-grow px-6 mb-6\">\n              <PricingFeatureList\n                items={featureItems}\n                everythingFrom={product.display?.everything_from}\n              />\n            </div>\n          )}\n        </div>\n        <div\n          className={cn(\" px-6 \", isRecommended && \"lg:-translate-y-12\")}\n        >\n          <PricingCardButton\n            recommended={productDisplay?.recommend_text ? true : false}\n            {...buttonProps}\n          >\n            {productDisplay?.button_text || buttonText}\n          </PricingCardButton>\n        </div>\n      </div>\n    </div>\n  );\n};\n\n// Pricing Feature List\nexport const PricingFeatureList = ({\n  items,\n  everythingFrom,\n  className,\n}: {\n  items: ProductItem[];\n  everythingFrom?: string;\n  className?: string;\n}) => {\n  return (\n    <div className={cn(\"flex-grow\", className)}>\n      {everythingFrom && (\n        <p className=\"text-sm mb-4\">\n          Everything from {everythingFrom}, plus:\n        </p>\n      )}\n      <div className=\"space-y-3\">\n        {items.map((item, index) => (\n          <div\n            key={index}\n            className=\"flex items-start gap-2 text-sm\"\n          >\n            {/* {showIcon && (\n              <Check className=\"h-4 w-4 text-primary flex-shrink-0 mt-0.5\" />\n            )} */}\n            <div className=\"flex flex-col\">\n              <span>{item.display?.primary_text}</span>\n              {item.display?.secondary_text && (\n                <span className=\"text-sm text-muted-foreground\">\n                  {item.display?.secondary_text}\n                </span>\n              )}\n            </div>\n          </div>\n        ))}\n      </div>\n    </div>\n  );\n};\n\n// Pricing Card Button\nexport interface PricingCardButtonProps extends React.ComponentProps<\"button\"> {\n  recommended?: boolean;\n  buttonUrl?: string;\n}\n\nexport const PricingCardButton = React.forwardRef<\n  HTMLButtonElement,\n  PricingCardButtonProps\n>(({ recommended, children, className, onClick, ...props }, ref) => {\n  const [loading, setLoading] = useState(false);\n\n  const handleClick = async (e: React.MouseEvent<HTMLButtonElement>) => {\n    setLoading(true);\n    try {\n      await onClick?.(e);\n    } catch (error) {\n      console.error(error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <Button\n      className={cn(\n        \"w-full py-3 px-4 group overflow-hidden relative transition-all duration-300 hover:brightness-90 border rounded-lg\",\n        className\n      )}\n      {...props}\n      variant={recommended ? \"default\" : \"secondary\"}\n      ref={ref}\n      disabled={loading || props.disabled}\n      onClick={handleClick}\n    >\n      {loading ? (\n        <Loader2 className=\"h-4 w-4 animate-spin\" />\n      ) : (\n        <>\n          <div className=\"flex items-center justify-between w-full transition-transform duration-300 group-hover:translate-y-[-130%]\">\n            <span>{children}</span>\n            <span className=\"text-sm\">→</span>\n          </div>\n          <div className=\"flex items-center justify-between w-full absolute px-4 translate-y-[130%] transition-transform duration-300 group-hover:translate-y-0 mt-2 group-hover:mt-0\">\n            <span>{children}</span>\n            <span className=\"text-sm\">→</span>\n          </div>\n        </>\n      )}\n    </Button>\n  );\n});\nPricingCardButton.displayName = \"PricingCardButton\";\n\n// Annual Switch\nexport const AnnualSwitch = ({\n  isAnnualToggle,\n  setIsAnnualToggle,\n}: {\n  isAnnualToggle: boolean;\n  setIsAnnualToggle: (isAnnual: boolean) => void;\n}) => {\n  return (\n    <div className=\"flex items-center space-x-2 mb-4\">\n      <span className=\"text-sm text-muted-foreground\">Monthly</span>\n      <Switch\n        id=\"annual-billing\"\n        checked={isAnnualToggle}\n        onCheckedChange={setIsAnnualToggle}\n      />\n      <span className=\"text-sm text-muted-foreground\">Annual</span>\n    </div>\n  );\n};\n\nexport const RecommendedBadge = ({ recommended }: { recommended: string }) => {\n  return (\n    <div className=\"bg-secondary absolute border text-muted-foreground text-sm font-medium lg:rounded-full px-3 lg:py-0.5 lg:top-4 lg:right-4 top-[-1px] right-[-1px] rounded-bl-lg\">\n      {recommended}\n    </div>\n  );\n};\n",
      "type": "registry:component",
      "target": "components/autumn/pricing-table.tsx"
    },
    {
      "path": "registry/pricing-table/lib/pricing-table-content.tsx",
      "content": "import { type Product } from \"autumn-js\";\n\nexport const getPricingTableContent = (product: Product) => {\n  const { scenario, free_trial, properties } = product;\n  const { is_one_off, updateable, has_trial } = properties;\n\n  if (has_trial) {\n    return {\n      buttonText: <p>Start Free Trial</p>,\n    };\n  }\n\n  switch (scenario) {\n    case \"scheduled\":\n      return {\n        buttonText: <p>Plan Scheduled</p>,\n      };\n\n    case \"active\":\n      if (updateable) {\n        return {\n          buttonText: <p>Update Plan</p>,\n        };\n      }\n\n      return {\n        buttonText: <p>Current Plan</p>,\n      };\n\n    case \"new\":\n      if (is_one_off) {\n        return {\n          buttonText: <p>Purchase</p>,\n        };\n      }\n\n      return {\n        buttonText: <p>Get started</p>,\n      };\n\n    case \"renew\":\n      return {\n        buttonText: <p>Renew</p>,\n      };\n\n    case \"upgrade\":\n      return {\n        buttonText: <p>Upgrade</p>,\n      };\n\n    case \"downgrade\":\n      return {\n        buttonText: <p>Downgrade</p>,\n      };\n\n    case \"cancel\":\n      return {\n        buttonText: <p>Cancel Plan</p>,\n      };\n\n    default:\n      return {\n        buttonText: <p>Get Started</p>,\n      };\n  }\n};\n",
      "type": "registry:lib",
      "target": "lib/autumn/pricing-table-content.tsx"
    }
  ]
}